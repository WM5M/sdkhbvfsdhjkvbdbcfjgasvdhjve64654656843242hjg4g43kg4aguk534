<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KOBRA DUI MENU</title>

<style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background: transparent;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
    user-select: none;
}

/* ================= MENU ================= */

#menu {
    position: absolute;
    top: 20px;
    left: 20px;
    width: 520px;
    height: 680px;
    background: rgba(0,0,0,0.93);
    border: 3px solid red;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(255,0,0,.7);
    display: none;
    flex-direction: column;
}

#header {
    padding: 14px;
    text-align: center;
    font-size: 20px;
    background: rgba(0,0,0,.6);
    border-bottom: 2px solid red;
}

#list {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

/* ================= ROW ================= */

.row {
    height: 52px;
    line-height: 52px;
    margin-bottom: 10px;
    text-align: center;
    border-radius: 10px;
    border: 2px solid red;
    background: rgba(20,20,20,.85);
    font-size: 18px;
}

.row.selected {
    background: rgba(255,0,0,.35);
    box-shadow: 0 0 18px rgba(255,0,0,.9);
}

/* ================= SCROLLBAR ================= */

#list::-webkit-scrollbar {
    width: 8px;
}
#list::-webkit-scrollbar-thumb {
    background: red;
    border-radius: 4px;
}

/* ================= KEYBOARD ================= */

#keyboard {
    position: absolute;
    inset: 0;
    display: none;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,.85);
    z-index: 9999;
}

#keyboardBox {
    width: 520px;
    padding: 30px;
    background: rgba(0,0,0,.95);
    border: 3px solid red;
    border-radius: 14px;
    box-shadow: 0 0 40px rgba(255,0,0,.9);
    text-align: center;
}

#keyboardTitle {
    font-size: 28px;
    margin-bottom: 20px;
    color: red;
}

#keyboardInput {
    width: 100%;
    padding: 16px;
    font-size: 26px;
    text-align: center;
    background: #111;
    border: 2px solid red;
    border-radius: 8px;
    color: white;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menu">
    <div id="header">Kobra Menu</div>
    <div id="list"></div>
</div>

<!-- KEYBOARD -->
<div id="keyboard">
    <div id="keyboardBox">
        <div id="keyboardTitle">Choose Menu Key</div>
        <input id="keyboardInput" type="text" readonly>
    </div>
</div>

<script>
/* ================= STATE ================= */

let items = [];
let index = 0;

/* ================= DOM ================= */

const menu = document.getElementById('menu');
const list = document.getElementById('list');
const keyboard = document.getElementById('keyboard');
const keyboardTitle = document.getElementById('keyboardTitle');
const keyboardInput = document.getElementById('keyboardInput');

/* ================= RENDER ================= */

function render() {
    list.innerHTML = '';

    items.forEach((item, i) => {
        const row = document.createElement('div');
        row.className = 'row' + (i === index ? ' selected' : '');

        let text = item.label || '';
        if (item.checked !== undefined) {
            text += item.checked ? ' : ON' : ' : OFF';
        } else if (item.value !== undefined) {
            text += ' : ' + Number(item.value).toFixed(2);
        }

        row.textContent = text;
        list.appendChild(row);
    });

    updateScroll();
}

/* ================= SCROLL ================= */

function updateScroll() {
    const rowHeight = 62;
    const top = index * rowHeight;
    const bottom = top + rowHeight;

    if (top < list.scrollTop) {
        list.scrollTop = top;
    } else if (bottom > list.scrollTop + list.clientHeight) {
        list.scrollTop = bottom - list.clientHeight;
    }
}

/* ================= NAV ================= */

function move(delta) {
    if (!items.length) return;
    index = (index + delta + items.length) % items.length;
    render();
}

/* ================= LUA MESSAGES ================= */

window.addEventListener('message', e => {
    const d = e.data;

    if (d.action === 'showUI') {
        menu.style.display = d.visible ? 'flex' : 'none';
    }

    if (d.action === 'updateElements') {
        items = d.elements || [];
        index = d.index || 0;
        if (items.length) render();
    }

    if (d.action === 'keydown') {
        if (d.key === 'ArrowUp') move(-1);
        if (d.key === 'ArrowDown') move(1);
    }

    if (d.action === 'updateKeyboard') {
        keyboard.style.display = d.visible ? 'flex' : 'none';
        keyboardTitle.textContent = d.title || 'Choose Menu Key';
        keyboardInput.value = d.value || '';
    }
});

/* ================= BROWSER FALLBACK ================= */

document.addEventListener('keydown', e => {
    if (menu.style.display === 'none') return;

    if (e.key === 'ArrowUp') {
        e.preventDefault();
        move(-1);
    }

    if (e.key === 'ArrowDown') {
        e.preventDefault();
        move(1);
    }
});
</script>

</body>
</html>
