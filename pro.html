<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KOBRA DUI MENU</title>

<style>
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background: transparent;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: white;
    user-select: none;
}

/* MENU WRAPPER */
#menu {
    position: absolute;
    top: 20px;
    left: 20px;
    width: 520px;
    height: 680px;
    background: rgba(0,0,0,0.93);
    border: 3px solid red;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(255,0,0,.7);
    display: none;
    flex-direction: column;
}

/* HEADER */
#header {
    padding: 14px;
    text-align: center;
    font-size: 20px;
    background: rgba(0,0,0,.6);
    border-bottom: 2px solid red;
}

/* LIST */
#list {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

/* ROW */
.row {
    height: 52px;                 /* FIXED HEIGHT = NO SKIP */
    line-height: 52px;
    margin-bottom: 10px;
    text-align: center;
    border-radius: 10px;
    border: 2px solid red;
    background: rgba(20,20,20,.85);
    font-size: 18px;
    transition: background .12s, box-shadow .12s;
}

.row.selected {
    background: rgba(255,0,0,.35);
    box-shadow: 0 0 18px rgba(255,0,0,.9);
}

/* SCROLLBAR */
#list::-webkit-scrollbar {
    width: 8px;
}
#list::-webkit-scrollbar-thumb {
    background: red;
    border-radius: 4px;
}
</style>
</head>

<body>

<div id="menu">
    <div id="header">Kobra Menu</div>
    <div id="list"></div>
</div>

<script>
/* ---------------- STATE ---------------- */
let items = [];
let index = 0;

/* ---------------- DOM ---------------- */
const menu = document.getElementById('menu');
const list = document.getElementById('list');

/* ---------------- RENDER ---------------- */
function render() {
    list.innerHTML = '';

    items.forEach((item, i) => {
        const row = document.createElement('div');
        row.className = 'row' + (i === index ? ' selected' : '');

        let label = item.label || '';
        if (item.checked !== undefined) {
            label += item.checked ? ' : ON' : ' : OFF';
        } else if (item.value !== undefined) {
            label += ' : ' + Number(item.value).toFixed(2);
        }

        row.textContent = label;
        list.appendChild(row);
    });

    updateScroll();
}

/* ---------------- SCROLL (NO JUMPING) ---------------- */
function updateScroll() {
    const rowHeight = 66; // height + margin
    const visibleTop = list.scrollTop;
    const visibleBottom = visibleTop + list.clientHeight;

    const rowTop = index * rowHeight;
    const rowBottom = rowTop + rowHeight;

    if (rowTop < visibleTop) {
        list.scrollTop = rowTop;
    } else if (rowBottom > visibleBottom) {
        list.scrollTop = rowBottom - list.clientHeight;
    }
}

/* ---------------- NAVIGATION ---------------- */
function move(delta) {
    if (!items.length) return;
    index = (index + delta + items.length) % items.length;
    render();
}

/* ---------------- MESSAGES FROM LUA ---------------- */
window.addEventListener('message', e => {
    const d = e.data;

    if (d.action === 'showUI') {
        menu.style.display = d.visible ? 'flex' : 'none';
    }

    if (d.action === 'updateElements') {
        items = d.elements || [];
        index = d.index || 0;

        if (items.length) {
            render();
        }
    }

    if (d.action === 'keydown') {
        if (d.key === 'ArrowUp') move(-1);
        if (d.key === 'ArrowDown') move(1);
    }
});

/* ---------------- BROWSER FALLBACK ---------------- */
document.addEventListener('keydown', e => {
    if (menu.style.display === 'none') return;

    if (e.key === 'ArrowUp') {
        e.preventDefault();
        move(-1);
    }

    if (e.key === 'ArrowDown') {
        e.preventDefault();
        move(1);
    }
});
</script>

</body>
</html>
